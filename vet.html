<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vet Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">

<h2>Vet Dashboard - Appointments</h2>
<div id="appointmentsList" class="mt-3"></div>

<!-- Modal for Health Form -->
<div class="modal fade" id="healthModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="healthForm">
                <div class="modal-header">
                    <h5 class="modal-title">Update Pet Health</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="appointmentId">

                    <p><strong>Pet:</strong> <span id="petNameDisplay"></span></p>
                    <p><strong>Owner:</strong> <span id="ownerNameDisplay"></span></p>

                    <div class="form-group mb-2">
                        <label>Weight (kg)</label>
                        <input type="number" id="weight" class="form-control" step="0.1" required>
                    </div>
                    <div class="form-group mb-2">
                        <label>Temperature (°C)</label>
                        <input type="number" id="temperature" class="form-control" step="0.1" required>
                    </div>
                    <div class="form-group mb-2">
                        <label>Notes</label>
                        <textarea id="notes" class="form-control"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Save Health</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const APPOINTMENTS_API = "http://localhost:8080/demo/appointments";
    const HEALTH_API = "http://localhost:8080/demo/health";

    async function loadAppointments() {
        let res = await fetch(APPOINTMENTS_API);
        let appointments = await res.json();

        let list = document.getElementById("appointmentsList");
        list.innerHTML = "";

        appointments.forEach(appt => {
            let card = document.createElement("div");
            card.className = "card mb-2 p-2";
            card.innerHTML = `
                <h5>Pet: ${appt.pet.name}</h5>
                <p>Owner: ${appt.pet.ownerName}</p>
                <p>Vet: Dr. ${appt.vetName}</p>
                <p>Date: ${appt.date}</p>
                <button class="btn btn-primary btn-sm" 
                        data-bs-toggle="modal" 
                        data-bs-target="#healthModal"
                        onclick="openHealthForm(${appt.id}, '${appt.pet.name}', '${appt.pet.ownerName}')">
                    Update Health
                </button>
            `;
            list.appendChild(card);
        });
    }

    function openHealthForm(apptId, petName, ownerName) {
        document.getElementById("appointmentId").value = apptId;
        document.getElementById("petNameDisplay").textContent = petName;
        document.getElementById("ownerNameDisplay").textContent = ownerName;
    }

    document.getElementById("healthForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        let healthRecord = {
            appointmentId: document.getElementById("appointmentId").value,
            weight: document.getElementById("weight").value,
            temperature: document.getElementById("temperature").value,
            notes: document.getElementById("notes").value
        };

        let res = await fetch(HEALTH_API, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(healthRecord)
        });

        if (res.ok) {
            alert("✅ Health record saved!");
            loadAppointments();
            document.getElementById("healthForm").reset();
            bootstrap.Modal.getInstance(document.getElementById("healthModal")).hide();
        } else {
            alert("❌ Failed to save health record");
        }
    });

    document.addEventListener("DOMContentLoaded", loadAppointments);
</script>
</body>
</html>
